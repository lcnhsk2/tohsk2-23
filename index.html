<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK Level 2 ‚Ä¢ Doraemon (Navigasi & Preview)</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }
        body {
            font-family: 'Segoe UI', 'Comic Sans MS', 'Chalkboard', sans-serif;
            background: linear-gradient(145deg, #6ec8f0 0%, #3b9bd6 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            margin: 0;
            position: relative;
            overflow-x: hidden;
        }
        .doraemon-bg {
            position: fixed;
            bottom: -20px;
            right: -20px;
            width: 280px;
            opacity: 0.15;
            z-index: 0;
            pointer-events: none;
        }
        .kantong-ajaib {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 80px;
            opacity: 0.4;
            z-index: 0;
        }
        .container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border-radius: 50px 50px 30px 30px;
            box-shadow: 0 20px 40px rgba(0, 50, 80, 0.5), 0 0 0 4px #f5e56b, 0 0 0 8px #e03a3a;
            padding: 30px 25px;
            position: relative;
            z-index: 10;
            border: 3px solid white;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            background: #fef9d7;
            padding: 15px 25px;
            border-radius: 60px 60px 30px 30px;
            border: 3px solid #e03a3a;
            box-shadow: inset 0 -3px 0 #b33f3f;
        }
        .header h1 {
            font-size: 1.8rem;
            color: #2a6f9c;
            text-shadow: 2px 2px 0 #f5e56b;
            letter-spacing: 2px;
        }
        .doraemon-icon {
            width: 70px;
            height: 70px;
            background: #1e90ff;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 5px 0 #0b4d7a;
            position: relative;
        }
        .doraemon-icon::before {
            content: "üê±";
            font-size: 45px;
            position: absolute;
            top: 5px;
            left: 8px;
        }
        .username-display {
            font-size: 1.5rem;
            background: #ffefc0;
            padding: 10px;
            border-radius: 40px;
            margin-bottom: 10px;
            border: 2px solid #f5a623;
            text-align: center;
        }
        .timer-panel {
            display: flex;
            justify-content: space-between;
            background: #2f5f8a;
            padding: 12px 25px;
            border-radius: 40px;
            color: white;
            font-weight: bold;
            border: 3px solid #f5e56b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-shadow: 2px 2px 0 #1d3e5e;
        }
        .timer-item {
            background: #0e3d5e;
            padding: 5px 20px;
            border-radius: 40px;
            box-shadow: inset 0 -3px 0 #0a2a3a;
        }
        .tab-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            font-size: 1.6rem;
            font-weight: bold;
            border-radius: 60px 60px 20px 20px;
            background: #b0d9f0;
            border: 3px solid #1e90ff;
            cursor: pointer;
            transition: 0.2s;
            color: #1d3e5e;
            box-shadow: 0 5px 0 #0b4d7a;
        }
        .tab.active {
            background: #f5e56b;
            border-color: #e03a3a;
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #b35f00;
        }
        .tab.completed {
            background: #a5d6a5;
            border-color: #2e7d32;
        }
        .question-box {
            background: #fffbf0;
            border-radius: 40px;
            padding: 30px;
            border: 4px solid #f5e56b;
            box-shadow: 0 8px 0 #d4a017, inset 0 2px 10px #ffeeaa;
            margin-bottom: 30px;
        }
        .question-text {
            font-size: 1.4rem;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #1e3b5c;
            font-weight: 600;
            background: #e6f3ff;
            padding: 15px 20px;
            border-radius: 30px;
            border: 2px dashed #3b9bd6;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .option-item {
            background: white;
            border-radius: 50px;
            padding: 12px 20px;
            border: 3px solid #3b9bd6;
            cursor: pointer;
            transition: 0.2s;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .option-item:hover {
            background: #c2e4ff;
            border-color: #e03a3a;
            transform: scale(1.01);
        }
        .option-item input[type="radio"] {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 3px solid #1e90ff;
            border-radius: 50%;
            outline: none;
            transition: 0.1s;
            cursor: pointer;
            background: white;
        }
        .option-item input[type="radio"]:checked {
            background: #e03a3a;
            border-color: #e03a3a;
            box-shadow: 0 0 0 3px #f5e56b;
        }
        .option-item label {
            flex: 1;
            cursor: pointer;
            color: #1d3e5e;
        }
        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }
        .nav-btn {
            background: #3b9bd6;
            border: none;
            font-size: 1.8rem;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 50px;
            color: white;
            text-shadow: 2px 2px 0 #1d5a7a;
            border-bottom: 6px solid #1d5a7a;
            cursor: pointer;
            flex: 1;
            transition: 0.07s;
        }
        .nav-btn:active {
            border-bottom-width: 2px;
            transform: translateY(4px);
        }
        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .btn-preview {
            background: #f5a623;
            border: none;
            font-size: 2rem;
            font-weight: bold;
            padding: 20px 30px;
            border-radius: 60px;
            color: white;
            text-shadow: 2px 2px 0 #b35f00;
            border-bottom: 8px solid #b35f00;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        .btn-preview:active {
            border-bottom-width: 2px;
            transform: translateY(6px);
        }
        .modal-start {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 80, 130, 0.95);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        .modal-card {
            background: #fef9d7;
            max-width: 500px;
            width: 90%;
            padding: 40px;
            border-radius: 80px 80px 40px 40px;
            border: 8px solid #f5e56b;
            text-align: center;
            box-shadow: 0 20px 0 #b35f00;
        }
        .modal-card h2 {
            font-size: 3rem;
            color: #e03a3a;
            margin-bottom: 10px;
        }
        .modal-card p {
            font-size: 1.5rem;
            margin: 20px 0;
            color: #1e3b5c;
        }
        .modal-card input {
            width: 80%;
            padding: 15px;
            border-radius: 50px;
            border: 3px solid #1e90ff;
            font-size: 1.5rem;
            text-align: center;
            margin: 20px 0;
            outline: none;
            background: white;
        }
        .btn-start {
            background: #1e90ff;
            border: none;
            font-size: 2.5rem;
            padding: 15px 40px;
            border-radius: 50px;
            color: white;
            border-bottom: 8px solid #0b4d7a;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
        }
        .btn-start:active {
            border-bottom-width: 2px;
            transform: translateY(6px);
        }
        .laporan {
            background: #e6f7ff;
            border-radius: 40px;
            padding: 25px;
            border: 4px solid #f5e56b;
            text-align: center;
        }
        .laporan h2 {
            font-size: 2.5rem;
            color: #e03a3a;
        }
        .laporan .skor {
            font-size: 3rem;
            background: #fff;
            display: inline-block;
            padding: 10px 40px;
            border-radius: 60px;
            margin: 20px;
            border: 5px solid #1e90ff;
        }
        .detail {
            display: flex;
            justify-content: space-around;
            font-size: 1.5rem;
            margin: 30px 0;
        }
        .btn-ulang {
            background: #f5a623;
            border: none;
            font-size: 2rem;
            padding: 15px 30px;
            border-radius: 50px;
            color: white;
            border-bottom: 6px solid #b35f00;
            cursor: pointer;
        }
        .footer {
            margin-top: 25px;
            text-align: center;
            color: #fff;
            text-shadow: 2px 2px 0 #1e3b5c;
        }
        .progress-info {
            text-align: center;
            font-size: 1.2rem;
            background: #ffe0a3;
            border-radius: 30px;
            padding: 8px;
            margin-bottom: 15px;
        }
        /* preview */
        .preview-grid {
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
            background: #fff5d6;
            border-radius: 30px;
        }
        .preview-item {
            background: white;
            border-radius: 30px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 15px solid;
        }
        .preview-item.correct {
            border-left-color: #2e7d32;
            background: #e8f5e9;
        }
        .preview-item.wrong {
            border-left-color: #c62828;
            background: #ffebee;
        }
        .preview-question {
            font-weight: bold;
        }
        .preview-answer {
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="kantong-ajaib">üîîüê±</div>
    <div class="doraemon-bg">üê±üîîüê±üîîüê±</div>

    <div class="container" id="mainContainer"></div>

    <script>
        (function() {
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.addEventListener('copy', e => e.preventDefault());
            document.addEventListener('cut', e => e.preventDefault());
            document.addEventListener('paste', e => e.preventDefault());

            // Data mentah (35 soal)
            const rawListening = [
                { no: 21, type: 'mc3', part: 'listening', question: '‰Ω†Ë¶ÅÂéª‰∏≠ÂõΩÔºüÂì™Â§©ÁöÑÈ£ûÊú∫ÔºüÁî∑ÔºöÂ∞±ÊòØ‰ªäÂ§©‰∏≠Âçà„ÄÇÈóÆÔºöÁî∑ÁöÑ‰ªÄ‰πàÊó∂ÂÄôÂéª‰∏≠ÂõΩÔºü', options: ['A ‰ªäÂ§©‰∏≠Âçà', 'B ÊòéÂ§©‰∏≠Âçà', 'C ÂêéÂ§©‰∏≠Âçà'], answer: 'A' },
                { no: 22, type: 'mc3', part: 'listening', question: 'Áî∑ÔºöÂÜçÊúâÂçÅÂàÜÈíüËàπÂ∞±Ë¶ÅÂºÄ‰∫ÜÔºå‰Ω†ÊúãÂèãÊÄé‰πàËøòÊ≤°Âà∞ÔºüÂ•≥ÔºöÊàë‰πü‰∏çÁü•ÈÅìÔºåÊàëÁªô‰ªñÊâì‰∏™ÁîµËØùÈóÆÈóÆ„ÄÇÈóÆÔºöÂ•≥ÁöÑË¶ÅÁªôË∞ÅÊâìÁîµËØùÔºü', options: ['A ‰∏àÂ§´', 'B ÂåªÁîü', 'C ÊúãÂèã'], answer: 'C' },
                { no: 23, type: 'mc3', part: 'listening', question: 'Â•≥Ôºö‰Ω†ÂñúÊ¨¢ÂñùÂíñÂï°ÂêóÔºüÁî∑Ôºö‰∏çÂ§™ÂñúÊ¨¢ÔºåÊàëÁà±ÂñùËå∂„ÄÇÈóÆÔºöÁî∑ÁöÑÁà±Âñù‰ªÄ‰πàÔºü', options: ['A Ëå∂', 'B ÁâõÂ•∂', 'C ÂíñÂï°'], answer: 'A' },
                { no: 24, type: 'mc3', part: 'listening', question: 'Áî∑ÔºöÁôΩËÄÅÂ∏àÔºåÊÇ®Êù•Ëøô‰∏™Â≠¶Ê†°Â§öÂ∞ëÂπ¥‰∫ÜÔºüÂ•≥ÔºöÊàë‰∫åÂçÅÂõõÂ≤ÅÂ∞±Êù•Ëøô‰∏™Â≠¶Ê†°‰∫ÜÔºåÂà∞Áé∞Âú®Êúâ‰∏âÂçÅÂ§öÂπ¥‰∫Ü„ÄÇÈóÆÔºöÂ•≥ÁöÑÂú®Âì™ÂÑøÂ∑•‰ΩúÔºü', options: ['A ÂåªÈô¢', 'B Â≠¶Ê†°', 'C ÂïÜÂ∫ó'], answer: 'B' },
                { no: 25, type: 'mc3', part: 'listening', question: 'Â•≥Ôºö‰Ω†ÊâæÂà∞‰Ω†ÁöÑÊâãË°®‰∫ÜÔºüÁî∑ÔºöÊ≤°ÊúâÔºåËøôÊòØÊàëÊò®Â§©Êñ∞‰π∞ÁöÑ„ÄÇÈóÆÔºöÈÇ£ÂùóÂÑøÊñ∞Ë°®ÊòØ‰ªÄ‰πàÊó∂ÂÄô‰π∞ÁöÑÔºü', options: ['A Êò®Â§©', 'B ‰∏ä‰∏™Êúà', 'C ÂéªÂπ¥'], answer: 'A' },
                { no: 26, type: 'mc3', part: 'listening', question: 'Áî∑ÔºöÊòØÁúüÁöÑÂêóÔºüÈÇ£Â§™ÊúâÊÑèÊÄù‰∫Ü„ÄÇÂ•≥ÔºöÊòØÁúüÁöÑÔºåÊàë‰πüËßâÂæóÂæàÂ•ΩÁ¨ë„ÄÇÈóÆÔºö‰ªñ‰ª¨ËßâÂæóÊÄé‰πàÊ†∑Ôºü', options: ['A ÂæàÂ•ΩÂêÉ', 'B ÂæàÂ•ΩÁ¨ë', 'C ÂæàÂ•ΩÂê¨'], answer: 'B' },
                { no: 27, type: 'mc3', part: 'listening', question: 'Â•≥Ôºö‰Ω†ÊÄé‰πàÂõûÊù•‰∫ÜÔºüÊ≤°ÂéªË∏¢Ë∂≥ÁêÉÔºüÁî∑ÔºöÂ§©Ê∞îÂ§™ÁÉ≠‰∫ÜÔºåÊâÄ‰ª•Â§ßÂÆ∂ÈÉΩÂõûÂéª‰∫Ü„ÄÇÈóÆÔºöÁî∑ÁöÑ‰∏∫‰ªÄ‰πàÂõûÊù•‰∫ÜÔºü', options: ['A Á¥Ø‰∫Ü', 'B Â§©Èò¥‰∫Ü', 'C Â§©Ê∞îÂ§™ÁÉ≠'], answer: 'C' },
                { no: 28, type: 'mc3', part: 'listening', question: 'Áî∑Ôºö‰Ω†Âà∞Âì™ÂÑø‰∫ÜÔºüÂ•≥ÔºöÊàëÂú®Âá∫ÁßüËΩ¶‰∏äÔºå‰∫îÂàÜÈíüÂêéÂ∞±Âà∞„ÄÇÈóÆÔºöÂ•≥ÁöÑÁé∞Âú®Âú®Âì™ÂÑøÔºü', options: ['A ÊàøÈó¥Èáå', 'B È£ûÊú∫‰∏ä', 'C Âá∫ÁßüËΩ¶‰∏ä'], answer: 'C' },
                { no: 29, type: 'mc3', part: 'listening', question: 'Â•≥ÔºöÁà∏Áà∏ÔºåËøô‰∏™Ëá™Ë°åËΩ¶ÊÄé‰πàÊ†∑ÔºüÁî∑ÔºöÂæàÊºÇ‰∫ÆÔºå‰Ω†ÂñúÊ¨¢ÂêóÔºüÈóÆÔºö‰ªñ‰ª¨Âú®Áúã‰ªÄ‰πàÔºü', options: ['A Ê§ÖÂ≠ê', 'B Ê°åÂ≠ê', 'C Ëá™Ë°åËΩ¶'], answer: 'C' },
                { no: 30, type: 'mc3', part: 'listening', question: 'Áî∑ÔºöÂêÉËçØ‰∫ÜÂêóÔºüÂ•≥ÔºöËøòÊ≤°Âë¢ÔºåÂêÉÂÆåÈ•≠‰∏Ä‰∏™Â∞èÊó∂ÂêéÂêÉ„ÄÇÈóÆÔºöÁî∑ÁöÑËÆ©Â•≥ÁöÑÂêÉ‰ªÄ‰πàÔºü', options: ['A ËçØ', 'B ÁæäËÇâ', 'C Á±≥È•≠'], answer: 'A' },
                { no: 31, type: 'mc3', part: 'listening', question: 'Áî∑ÔºöÂ§©Êô¥‰∫ÜÔºåÊàë‰ª¨Âá∫ÂéªËµ∞Ëµ∞Âêß„ÄÇÂ•≥ÔºöÊàëÊÉ≥Âú®ÂÆ∂ÁúãÁîµËßÜ„ÄÇÁî∑ÔºöÂõûÊù•ÂÜçÁúãÔºüÂ•≥ÔºöÂ•ΩÂêßÔºåÈÇ£‰Ω†Á≠âÊàë‰∏Ä‰∏ãÔºåÊàëÂéªÁ©ø‰ª∂Ë°£Êúç„ÄÇÈóÆÔºöÂ§ñÈù¢Â§©Ê∞îÊÄé‰πàÊ†∑Ôºü', options: ['A ‰∏ãÈõ®‰∫Ü', 'B ‰∏ãÈõ™‰∫Ü', 'C Â§©Êô¥‰∫Ü'], answer: 'C' },
                { no: 32, type: 'mc3', part: 'listening', question: 'Â•≥ÔºöÊàë‰ª¨Ë¶Å‰∫ÜÂá†‰∏™Ëèú‰∫ÜÔºüÁî∑ÔºöÊàëÁúãÁúãÔºåÁé∞Âú®ÊòØ‰∏É‰∏™„ÄÇÂ•≥ÔºöÂ•ΩÔºåÂÜçË¶Å‰∏Ä‰∏™È±ºÂ∞±ÂèØ‰ª•‰∫ÜÔºåÂ∞±Ëøô‰∫õÔºåË∞¢Ë∞¢„ÄÇÁî∑Ôºö‰∏çÂÆ¢Ê∞î„ÄÇÈóÆÔºö‰ªñ‰ª¨ÊúÄÂèØËÉΩÂú®Âì™ÂÑøÔºü', options: ['A Ê∞¥ÊûúÂ∫ó', 'B È•≠Â∫óÈáå', 'C Â¶πÂ¶πÂÆ∂'], answer: 'B' },
                { no: 33, type: 'mc3', part: 'listening', question: 'Áî∑Ôºö‰Ω†ÁúãÈÇ£ÂùóÂÑøÊâãË°®ÊÄé‰πàÊ†∑ÔºüÊàëÂºüÂºü‰ºö‰∏ç‰ºöÂñúÊ¨¢ÔºüÂ•≥ÔºöÂæàÊºÇ‰∫ÆÔºå‰ΩÜÊòØÂ§™Ë¥µ‰∫Ü„ÄÇÁî∑Ôºö‰∏§ÁôæÂùóÔºå‰∏çË¥µ„ÄÇÂ•≥Ôºö‰Ω†ÂÜçÁúãÁúãÔºåÈÇ£ÊòØ‰∏§ÂçÉÔºå‰Ω†Â∞ëËØ¥‰∫Ü‰∏Ä‰∏™Èõ∂„ÄÇÈóÆÔºöÁî∑ÁöÑÊÉ≥ÁªôË∞Å‰π∞ÊâãË°®Ôºü', options: ['A ÂºüÂºü', 'B ÊúçÂä°Âëò', 'C Ê±âËØ≠ËÄÅÂ∏à'], answer: 'A' },
                { no: 34, type: 'mc3', part: 'listening', question: 'Â•≥ÔºöÂÖ´ÁÇπ‰∫ÜÔºåÊÄé‰πàËøò‰∏çËµ∑Â∫äÔºüÁî∑ÔºöËÆ©ÊàëÂÜçÁù°‰∫åÂçÅÂàÜÈíü„ÄÇÂ•≥Ôºö‰∫åÂçÅÂàÜÈíüÔºü‰Ω†‰∏çÂéª‰∏äÁè≠‰∫ÜÔºüÁî∑Ôºö‰ªäÂ§©ÊòØÊòüÊúüÂÖ≠„ÄÇÈóÆÔºöÂ•≥ÁöÑÊÉ≥ËÆ©Áî∑ÁöÑÂÅö‰ªÄ‰πàÔºü', options: ['A Ê∏∏Ê≥≥', 'B Ëµ∑Â∫ä', 'C ÊâìÁØÆÁêÉ'], answer: 'B' },
                { no: 35, type: 'mc3', part: 'listening', question: 'Áî∑ÔºöÊòéÂ§©‰Ω†ÂéªÂêóÔºüÂ•≥Ôºö‰∏çÂéª‰∫ÜÔºåÊàëÊòéÂ§©‰∏äÂçàÊúâËØæ„ÄÇÁî∑ÔºöÊòéÂ§©ÊòüÊúüÊó•ÔºåÊÄé‰πàËøòÊúâËØæÔºüÂ•≥ÔºöÊòØÂéªÂ≠¶ÂºÄËΩ¶„ÄÇÈóÆÔºöÂ•≥ÁöÑ‰∏∫‰ªÄ‰πàÊòéÂ§©‰∏çËÉΩÂéªÔºü', options: ['A Ë¶ÅÂçñÊä•Á∫∏', 'B Ë¶ÅÂéª‰∏äËØæ', 'C Ë¶ÅÂéªÂî±Ê≠å'], answer: 'B' }
            ];
            const rawReading = [
                { no: 41, type: 'mc6', part: 'reading', question: 'ÂØπ‰∏çËµ∑ÔºåÊàëÁé∞Âú®ÂæàÂøôÔºåÊ≤°Ôºà Ôºâ„ÄÇ', options: ['A Êó∂Èó¥', 'B Êú∫Âú∫', 'C ÂºÄÂßã', 'D ÁîüÁóÖ', 'E Ë¥µ', 'F ‰ªé'], answer: 'A' },
                { no: 42, type: 'mc6', part: 'reading', question: 'ÁîµÂΩ±Â∞±Ë¶ÅÔºà Ôºâ‰∫ÜÔºå‰Ω†‰ª¨Âø´ÁÇπÂÑøËøõÂéªÂêß„ÄÇ', options: ['A Êó∂Èó¥', 'B Êú∫Âú∫', 'C ÂºÄÂßã', 'D ÁîüÁóÖ', 'E Ë¥µ', 'F ‰ªé'], answer: 'C' },
                { no: 43, type: 'mc6', part: 'reading', question: 'ÂñÇÔºåÊàëÂ∑≤ÁªèÔºà ÔºâÊïôÂÆ§Âá∫Êù•‰∫ÜÔºå‰Ω†Âú®Âì™ÂÑøÂë¢Ôºü', options: ['A Êó∂Èó¥', 'B Êú∫Âú∫', 'C ÂºÄÂßã', 'D ÁîüÁóÖ', 'E Ë¥µ', 'F ‰ªé'], answer: 'F' },
                { no: 44, type: 'mc6', part: 'reading', question: 'Â¶ªÂ≠êÔºà Ôºâ‰∫ÜÔºå‰ªñ‰∏Ä‰∏™Êôö‰∏äÈÉΩÊ≤°Áù°Ëßâ„ÄÇ', options: ['A Êó∂Èó¥', 'B Êú∫Âú∫', 'C ÂºÄÂßã', 'D ÁîüÁóÖ', 'E Ë¥µ', 'F ‰ªé'], answer: 'D' },
                { no: 45, type: 'mc6', part: 'reading', question: 'Â•≥ÔºöËØ∑ÈóÆÔºåËøôÂÑøÁ¶ªÔºà ÔºâËøòËøúÂêóÔºüÁî∑Ôºö‰∏çËøú‰∫ÜÔºåÂÜçÊúâ10ÂàÜÈíüÂ∞±Âà∞‰∫Ü„ÄÇ', options: ['A Êó∂Èó¥', 'B Êú∫Âú∫', 'C ÂºÄÂßã', 'D ÁîüÁóÖ', 'E Ë¥µ', 'F ‰ªé'], answer: 'B' },
                { no: 46, type: 'tf', part: 'reading', question: 'Êúâ‰∫õ‰∫∫ÂñúÊ¨¢Êó©‰∏äËµ∑Â∫äÂêéÂñù‰∏ÄÊùØÊ∞¥ÔºåÂõ†‰∏∫Êó©‰∏äÂñùÊ∞¥ÂØπË∫´‰ΩìÈùûÂ∏∏Â•Ω„ÄÇ\n‚òÖ Êó©‰∏äÂñùÊ∞¥ÂØπË∫´‰Ωì‰∏çÂ•Ω„ÄÇ', options: ['‚àö ÂØπ', '√ó Èîô'], answer: '√ó' },
                { no: 47, type: 'tf', part: 'reading', question: 'ÊàëËøôÊ¨°‰ΩèÁöÑÊóÖÈ¶ÜÂú®ÁÅ´ËΩ¶Á´ôÊóÅËæπÔºå‰πü‰∏çË¥µÔºåÊàëËßâÂæóÂæà‰∏çÈîôÔºå‰∏ãÊ¨°Êù•ÊàëËøò‰ΩèÈÇ£ÂÑø„ÄÇ\n‚òÖ ÈÇ£ÂÆ∂ÊóÖÈ¶ÜÁ¶ªÁÅ´ËΩ¶Á´ôÂæàËøë„ÄÇ', options: ['‚àö ÂØπ', '√ó Èîô'], answer: '‚àö' },
                { no: 48, type: 'tf', part: 'reading', question: 'ÂÑøÂ≠êÔºå‰Ω†ÊØèÂ§©ËøêÂä®ÁöÑÊó∂Èó¥Â§™Â∞ë‰∫ÜÔºåÊòéÂ§©Êó©‰∏äÂíåÊàë‰∏ÄËµ∑ÂéªË∑ëÊ≠•Âêß„ÄÇ\n‚òÖ ‰ªñÊÉ≥ËÆ©ÂÑøÂ≠êÂ§öËøêÂä®„ÄÇ', options: ['‚àö ÂØπ', '√ó Èîô'], answer: '‚àö' },
                { no: 49, type: 'tf', part: 'reading', question: 'Á≠âËÄÉÂÆåËØïÔºåÊàë‰ª¨ÂáÜÂ§áÂéªÂåó‰∫¨Áé©ÂÑø‰∏§Â§©Ôºå‰Ω†Âéª‰∏çÂéªÔºü\n‚òÖ ‰ªñÊ≠£Âú®Âåó‰∫¨ÊóÖÊ∏∏„ÄÇ', options: ['‚àö ÂØπ', '√ó Èîô'], answer: '√ó' },
                { no: 50, type: 'tf', part: 'reading', question: 'Ëøô‰∏™ÁîµÂΩ±ÂæàÈïøÔºåÊúâ‰∏§‰∏™Â§öÂ∞èÊó∂Ôºå‰∏ÄÂº†Á•®120ÂÖÉÔºåÂ≠¶ÁîüÁ•®70ÂÖÉ„ÄÇ\n‚òÖ Â≠¶ÁîüÁ•®‰æøÂÆú„ÄÇ', options: ['‚àö ÂØπ', '√ó Èîô'], answer: '‚àö' },
                { no: 51, type: 'mc6', part: 'reading', question: 'ËØ∑‰Ω†Êù•ÂõûÁ≠îËøô‰∏™ÈóÆÈ¢òÂ•Ω‰∏çÂ•ΩÔºü', options: ['A ÊàëËßâÂæóÂÜôÂæóÈùûÂ∏∏Â•ΩÔºåÊàëÂÖàÁîü‰πüÂæàÂñúÊ¨¢„ÄÇ', 'B ÂØπ‰∏çËµ∑ÔºåËÄÅÂ∏àÔºåÊàëÊ≤°Âê¨ÊáÇ„ÄÇ', 'C Êó©ÁÇπÂÑø‰ºëÊÅØÔºåÊòéÂ§©‰∏äÂçà9ÁÇπËßÅ„ÄÇ', 'D Âì•Ôºå‰Ω†ÁöÑÁîµËÑëÂ§™ÊÖ¢‰∫Ü„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F Ë∞¢Ë∞¢‰Ω†ÂëäËØâÊàëËøô‰ª∂‰∫ãÊÉÖ„ÄÇ'], answer: 'B' },
                { no: 52, type: 'mc6', part: 'reading', question: 'ËøôÂ∑≤ÁªèÊØîÂâçÂá†Â§©Âø´Â§ö‰∫Ü„ÄÇ', options: ['A ÊàëËßâÂæóÂÜôÂæóÈùûÂ∏∏Â•ΩÔºåÊàëÂÖàÁîü‰πüÂæàÂñúÊ¨¢„ÄÇ', 'B ÂØπ‰∏çËµ∑ÔºåËÄÅÂ∏àÔºåÊàëÊ≤°Âê¨ÊáÇ„ÄÇ', 'C Êó©ÁÇπÂÑø‰ºëÊÅØÔºåÊòéÂ§©‰∏äÂçà9ÁÇπËßÅ„ÄÇ', 'D Âì•Ôºå‰Ω†ÁöÑÁîµËÑëÂ§™ÊÖ¢‰∫Ü„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F Ë∞¢Ë∞¢‰Ω†ÂëäËØâÊàëËøô‰ª∂‰∫ãÊÉÖ„ÄÇ'], answer: 'D' },
                { no: 53, type: 'mc6', part: 'reading', question: '‰ªäÂ§©Áé©ÂÑø‰∫Ü‰∏ÄÂ§©ÔºåÁ¥Ø‰∫ÜÂêßÔºü', options: ['A ÊàëËßâÂæóÂÜôÂæóÈùûÂ∏∏Â•ΩÔºåÊàëÂÖàÁîü‰πüÂæàÂñúÊ¨¢„ÄÇ', 'B ÂØπ‰∏çËµ∑ÔºåËÄÅÂ∏àÔºåÊàëÊ≤°Âê¨ÊáÇ„ÄÇ', 'C Êó©ÁÇπÂÑø‰ºëÊÅØÔºåÊòéÂ§©‰∏äÂçà9ÁÇπËßÅ„ÄÇ', 'D Âì•Ôºå‰Ω†ÁöÑÁîµËÑëÂ§™ÊÖ¢‰∫Ü„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F Ë∞¢Ë∞¢‰Ω†ÂëäËØâÊàëËøô‰ª∂‰∫ãÊÉÖ„ÄÇ'], answer: 'C' },
                { no: 54, type: 'mc6', part: 'reading', question: '‰∏çÂÆ¢Ê∞îÔºåÂ∏åÊúõËÉΩÂØπ‰Ω†ÊúâÂ∏ÆÂä©„ÄÇ', options: ['A ÊàëËßâÂæóÂÜôÂæóÈùûÂ∏∏Â•ΩÔºåÊàëÂÖàÁîü‰πüÂæàÂñúÊ¨¢„ÄÇ', 'B ÂØπ‰∏çËµ∑ÔºåËÄÅÂ∏àÔºåÊàëÊ≤°Âê¨ÊáÇ„ÄÇ', 'C Êó©ÁÇπÂÑø‰ºëÊÅØÔºåÊòéÂ§©‰∏äÂçà9ÁÇπËßÅ„ÄÇ', 'D Âì•Ôºå‰Ω†ÁöÑÁîµËÑëÂ§™ÊÖ¢‰∫Ü„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F Ë∞¢Ë∞¢‰Ω†ÂëäËØâÊàëËøô‰ª∂‰∫ãÊÉÖ„ÄÇ'], answer: 'F' },
                { no: 55, type: 'mc6', part: 'reading', question: '‰Ω†ÈÄÅÊàëÁöÑÈÇ£Êú¨‰π¶ÊàëÂ∑≤ÁªèËØªÂÆå‰∫Ü„ÄÇ', options: ['A ÊàëËßâÂæóÂÜôÂæóÈùûÂ∏∏Â•ΩÔºåÊàëÂÖàÁîü‰πüÂæàÂñúÊ¨¢„ÄÇ', 'B ÂØπ‰∏çËµ∑ÔºåËÄÅÂ∏àÔºåÊàëÊ≤°Âê¨ÊáÇ„ÄÇ', 'C Êó©ÁÇπÂÑø‰ºëÊÅØÔºåÊòéÂ§©‰∏äÂçà9ÁÇπËßÅ„ÄÇ', 'D Âì•Ôºå‰Ω†ÁöÑÁîµËÑëÂ§™ÊÖ¢‰∫Ü„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F Ë∞¢Ë∞¢‰Ω†ÂëäËØâÊàëËøô‰ª∂‰∫ãÊÉÖ„ÄÇ'], answer: 'A' },
                { no: 56, type: 'mc5', part: 'reading', question: 'Â∑¶ËæπÊòØ‚ÄúÂ•≥‚ÄùÂ≠óÔºåÂè≥ËæπÊòØ‚ÄúÁîü‚ÄùÂ≠ó„ÄÇ', options: ['A ‰Ω†Áü•ÈÅì‚ÄúÂßì‚ÄùÊÄé‰πàÂÜôÂêóÔºü', 'B ÊàëÂú®Ë∑Ø‰∏ä‰π∞‰∫ÜÁÇπÂÑøËãπÊûú„ÄÇ', 'C ‰Ω†ÊÄé‰πà‰ºöËÆ§ËØÜÈÇ£‰∏™Â≠©Â≠êÔºü', 'D È¢úËâ≤‰∏çÈîôÔºåÊØîÈªëÁöÑÂ•ΩÁúã„ÄÇ', 'E ‰Ω†Â•ΩÔºåËØ∑ÈóÆÊùéÂ∞èÂßê‰ΩèÂì™‰∏™ÊàøÈó¥Ôºü'], answer: 'A' },
                { no: 57, type: 'mc5', part: 'reading', question: 'ÊàëÊÉ≥‰π∞ÊâãÊú∫Ôºå‰Ω†ÁúãËøô‰∏™Á∫¢ÁöÑÊÄé‰πàÊ†∑Ôºü', options: ['A ‰Ω†Áü•ÈÅì‚ÄúÂßì‚ÄùÊÄé‰πàÂÜôÂêóÔºü', 'B ÊàëÂú®Ë∑Ø‰∏ä‰π∞‰∫ÜÁÇπÂÑøËãπÊûú„ÄÇ', 'C ‰Ω†ÊÄé‰πà‰ºöËÆ§ËØÜÈÇ£‰∏™Â≠©Â≠êÔºü', 'D È¢úËâ≤‰∏çÈîôÔºåÊØîÈªëÁöÑÂ•ΩÁúã„ÄÇ', 'E ‰Ω†Â•ΩÔºåËØ∑ÈóÆÊùéÂ∞èÂßê‰ΩèÂì™‰∏™ÊàøÈó¥Ôºü'], answer: 'D' },
                { no: 58, type: 'mc5', part: 'reading', question: 'ÁªôÊàëÂêßÔºåÊàëÂéªÊ¥óÊ¥ó„ÄÇ', options: ['A ‰Ω†Áü•ÈÅì‚ÄúÂßì‚ÄùÊÄé‰πàÂÜôÂêóÔºü', 'B ÊàëÂú®Ë∑Ø‰∏ä‰π∞‰∫ÜÁÇπÂÑøËãπÊûú„ÄÇ', 'C ‰Ω†ÊÄé‰πà‰ºöËÆ§ËØÜÈÇ£‰∏™Â≠©Â≠êÔºü', 'D È¢úËâ≤‰∏çÈîôÔºåÊØîÈªëÁöÑÂ•ΩÁúã„ÄÇ', 'E ‰Ω†Â•ΩÔºåËØ∑ÈóÆÊùéÂ∞èÂßê‰ΩèÂì™‰∏™ÊàøÈó¥Ôºü'], answer: 'B' },
                { no: 59, type: 'mc5', part: 'reading', question: '‰ªñÊòØÂ•≥ÂÑøÁöÑÂêåÂ≠¶ÔºåÊù•ËøáÊàë‰ª¨ÂÆ∂„ÄÇ', options: ['A ‰Ω†Áü•ÈÅì‚ÄúÂßì‚ÄùÊÄé‰πàÂÜôÂêóÔºü', 'B ÊàëÂú®Ë∑Ø‰∏ä‰π∞‰∫ÜÁÇπÂÑøËãπÊûú„ÄÇ', 'C ‰Ω†ÊÄé‰πà‰ºöËÆ§ËØÜÈÇ£‰∏™Â≠©Â≠êÔºü', 'D È¢úËâ≤‰∏çÈîôÔºåÊØîÈªëÁöÑÂ•ΩÁúã„ÄÇ', 'E ‰Ω†Â•ΩÔºåËØ∑ÈóÆÊùéÂ∞èÂßê‰ΩèÂì™‰∏™ÊàøÈó¥Ôºü'], answer: 'C' },
                { no: 60, type: 'mc5', part: 'reading', question: '507ÔºåÂ∑¶ËæπÁ¨¨‰∏Ä‰∏™„ÄÇ', options: ['A ‰Ω†Áü•ÈÅì‚ÄúÂßì‚ÄùÊÄé‰πàÂÜôÂêóÔºü', 'B ÊàëÂú®Ë∑Ø‰∏ä‰π∞‰∫ÜÁÇπÂÑøËãπÊûú„ÄÇ', 'C ‰Ω†ÊÄé‰πà‰ºöËÆ§ËØÜÈÇ£‰∏™Â≠©Â≠êÔºü', 'D È¢úËâ≤‰∏çÈîôÔºåÊØîÈªëÁöÑÂ•ΩÁúã„ÄÇ', 'E ‰Ω†Â•ΩÔºåËØ∑ÈóÆÊùéÂ∞èÂßê‰ΩèÂì™‰∏™ÊàøÈó¥Ôºü'], answer: 'E' }
            ];

            // Fungsi pengacakan (Fisher-Yates)
            function shuffleArray(arr) {
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            }

            // Salin dan acak setiap bagian
            let listeningQuestions = shuffleArray([...rawListening]);
            let readingQuestions = shuffleArray([...rawReading]);

            // State jawaban per bagian (urutan sesuai acakan)
            let listeningAnswers = new Array(listeningQuestions.length).fill(null);
            let readingAnswers = new Array(readingQuestions.length).fill(null);
            let listeningCurrent = 0;
            let readingCurrent = 0;
            let activeTab = 'listening'; // mulai dari listening

            let testStarted = false;
            let testFinished = false;
            let userName = "Peserta";

            // Timer global: 47 menit = 2820 detik
            const TOTAL_GLOBAL_SECONDS = 47 * 60;
            let globalTimeLeft = TOTAL_GLOBAL_SECONDS;
            let perSoalTimeLeft = 60;

            let globalTimerInterval = null;
            let perSoalTimerInterval = null;

            const container = document.getElementById('mainContainer');

            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            function clearAllIntervals() {
                if (globalTimerInterval) clearInterval(globalTimerInterval);
                if (perSoalTimerInterval) clearInterval(perSoalTimerInterval);
                globalTimerInterval = null;
                perSoalTimerInterval = null;
            }

            // Mendapatkan data bagian aktif
            function getCurrentData() {
                if (activeTab === 'listening') {
                    return {
                        questions: listeningQuestions,
                        answers: listeningAnswers,
                        currentIdx: listeningCurrent,
                        setAnswer: (idx, val) => { listeningAnswers[idx] = val; }
                    };
                } else {
                    return {
                        questions: readingQuestions,
                        answers: readingAnswers,
                        currentIdx: readingCurrent,
                        setAnswer: (idx, val) => { readingAnswers[idx] = val; }
                    };
                }
            }

            // Simpan jawaban dari radio ke state (dipanggil saat change)
            function saveCurrentAnswer(value) {
                const data = getCurrentData();
                if (data.currentIdx < data.questions.length) {
                    data.setAnswer(data.currentIdx, value);
                }
            }

            // Navigasi
            function goToPrev() {
                const data = getCurrentData();
                if (data.currentIdx > 0) {
                    if (activeTab === 'listening') {
                        listeningCurrent--;
                    } else {
                        readingCurrent--;
                    }
                    perSoalTimeLeft = 60;
                    renderSoal();
                }
            }

            function goToNext() {
                const data = getCurrentData();
                if (data.currentIdx + 1 < data.questions.length) {
                    if (activeTab === 'listening') {
                        listeningCurrent++;
                    } else {
                        readingCurrent++;
                    }
                    perSoalTimeLeft = 60;
                    renderSoal();
                } else {
                    // jika sudah di akhir bagian, coba pindah tab ke reading jika listening selesai
                    if (activeTab === 'listening' && readingQuestions.length > 0) {
                        // pindah ke reading
                        activeTab = 'reading';
                        perSoalTimeLeft = 60;
                        renderSoal();
                    }
                    // jika reading sudah habis, mungkin tampilkan preview?
                }
            }

            // Timer per soal habis
            function perSoalWaktuHabis() {
                if (testFinished) return;
                // otomatis pindah ke next (jawaban tetap null)
                goToNext();
            }

            function globalWaktuHabis() {
                if (testFinished) return;
                clearAllIntervals();
                testFinished = true;
                tampilkanPreview(); // langsung preview kalau waktu habis
            }

            function startTimers() {
                clearAllIntervals();

                globalTimerInterval = setInterval(() => {
                    if (testFinished) return;
                    globalTimeLeft--;
                    if (globalTimeLeft <= 0) {
                        globalTimeLeft = 0;
                        globalWaktuHabis();
                    }
                    const globalEl = document.getElementById('globalTimerDisplay');
                    const perEl = document.getElementById('perSoalTimerDisplay');
                    if (globalEl) globalEl.innerText = formatTime(globalTimeLeft);
                    if (perEl) perEl.innerText = formatTime(perSoalTimeLeft);
                }, 1000);

                perSoalTimerInterval = setInterval(() => {
                    if (testFinished) return;
                    perSoalTimeLeft--;
                    if (perSoalTimeLeft <= 0) {
                        perSoalTimeLeft = 0;
                        clearInterval(perSoalTimerInterval);
                        perSoalTimerInterval = null;
                        perSoalWaktuHabis();
                    }
                    const perEl = document.getElementById('perSoalTimerDisplay');
                    if (perEl) perEl.innerText = formatTime(perSoalTimeLeft);
                }, 1000);
            }

            function renderModal() {
                container.innerHTML = `
                    <div class="modal-start" id="modalStart">
                        <div class="modal-card">
                            <h2>üê± HSK ‰∫åÁ∫ß Ê®°ÊãüËÄÉËØï</h2>
                            <p>by lcnpalembang-08994477998</p>
                            <p>üìã Listening 15 soal ‚Ä¢ Reading 20 soal</p>
                            <p>‚è± Total 47 menit | 60 detik per soal</p>
                            <input type="text" id="usernameInput" placeholder="Masukkan nama kamu" value="${userName}">
                            <button class="btn-start" id="btnStart">Mulai</button>
                        </div>
                    </div>
                `;
                document.getElementById('btnStart').addEventListener('click', () => {
                    const input = document.getElementById('usernameInput');
                    if (input.value.trim() !== '') {
                        userName = input.value.trim();
                    } else {
                        userName = 'ÂßìÂêç';
                    }
                    document.getElementById('modalStart').style.display = 'none';
                    startTest();
                });
            }

            function startTest() {
                testStarted = true;
                testFinished = false;
                // Reset jawaban
                listeningAnswers.fill(null);
                readingAnswers.fill(null);
                listeningCurrent = 0;
                readingCurrent = 0;
                activeTab = 'listening';
                globalTimeLeft = TOTAL_GLOBAL_SECONDS;
                perSoalTimeLeft = 60;
                renderSoal();
                startTimers();
            }

            function renderSoal() {
                const data = getCurrentData();
                const q = data.questions[data.currentIdx];
                if (!q) {
                    // Jika tidak ada soal (misal bagian kosong), langsung preview?
                    tampilkanPreview();
                    return;
                }

                let optionsHtml = '';
                if (q.type === 'mc3' || q.type === 'mc5' || q.type === 'mc6') {
                    q.options.forEach((opt, idx) => {
                        const letter = opt.split(' ')[0];
                        const checked = (data.answers[data.currentIdx] === letter) ? 'checked' : '';
                        optionsHtml += `
                            <div class="option-item" onclick="document.getElementById('opt_${activeTab}_${data.currentIdx}_${letter}').click();">
                                <input type="radio" name="soal" id="opt_${activeTab}_${data.currentIdx}_${letter}" value="${letter}" ${checked}>
                                <label for="opt_${activeTab}_${data.currentIdx}_${letter}">${opt}</label>
                            </div>
                        `;
                    });
                } else if (q.type === 'tf') {
                    const checkedTrue = (data.answers[data.currentIdx] === '‚àö') ? 'checked' : '';
                    const checkedFalse = (data.answers[data.currentIdx] === '√ó') ? 'checked' : '';
                    optionsHtml += `
                        <div class="option-item" onclick="document.getElementById('opt_${activeTab}_${data.currentIdx}_‚àö').click();">
                            <input type="radio" name="soal" id="opt_${activeTab}_${data.currentIdx}_‚àö" value="‚àö" ${checkedTrue}>
                            <label for="opt_${activeTab}_${data.currentIdx}_‚àö">${q.options[0]}</label>
                        </div>
                        <div class="option-item" onclick="document.getElementById('opt_${activeTab}_${data.currentIdx}_√ó').click();">
                            <input type="radio" name="soal" id="opt_${activeTab}_${data.currentIdx}_√ó" value="√ó" ${checkedFalse}>
                            <label for="opt_${activeTab}_${data.currentIdx}_√ó">${q.options[1]}</label>
                        </div>
                    `;
                }

                const listeningCompleted = listeningCurrent >= listeningQuestions.length ? 'completed' : '';
                const readingCompleted = readingCurrent >= readingQuestions.length ? 'completed' : '';

                // Cek apakah semua soal sudah dijawab (untuk tampilkan tombol preview)
                const allListeningAnswered = listeningAnswers.every(ans => ans !== null);
                const allReadingAnswered = readingAnswers.every(ans => ans !== null);
                const showPreviewButton = allListeningAnswered && allReadingAnswered;

                container.innerHTML = `
                    <div class="header">
                        <div class="doraemon-icon"></div>
                        <h1>HSK 2 ‚Ä¢ Doraemon</h1>
                        <div style="width:50px;"></div>
                    </div>
                    <div class="username-display">üë§ ${userName}</div>
                    <div class="timer-panel">
                        <span class="timer-item">‚è≥ Sisa: <span id="perSoalTimerDisplay">${formatTime(perSoalTimeLeft)}</span></span>
                        <span class="timer-item">‚åõ Total: <span id="globalTimerDisplay">${formatTime(globalTimeLeft)}</span></span>
                    </div>
                    <div class="tab-bar">
                        <div class="tab ${activeTab === 'listening' ? 'active' : ''} ${listeningCompleted}" id="tabListening">üëÇ Listening ${listeningCurrent+1}/${listeningQuestions.length}</div>
                        <div class="tab ${activeTab === 'reading' ? 'active' : ''} ${readingCompleted}" id="tabReading">üìñ Reading ${readingCurrent+1}/${readingQuestions.length}</div>
                    </div>
                    <div class="progress-info">Soal ke-${data.currentIdx+1} dari ${data.questions.length}</div>
                    <div class="question-box">
                        <div class="question-text">${q.question.replace(/\n/g, '<br>')}</div>
                        <div class="options" id="optionsContainer">
                            ${optionsHtml}
                        </div>
                        <div class="nav-buttons">
                            <button class="nav-btn" id="backBtn" ${data.currentIdx === 0 ? 'disabled' : ''}>‚óÄ Back</button>
                            <button class="nav-btn" id="nextBtn">Next ‚ñ∂</button>
                        </div>
                    </div>
                    ${showPreviewButton ? '<button class="btn-preview" id="previewBtn">üìã Lihat Preview & Hasil</button>' : ''}
                    <div class="footer">üîî Jangan nyontek, nanti kena rahasia Doraemon!</div>
                `;

                // Event listener radio untuk menyimpan jawaban
                const radios = document.querySelectorAll('input[name="soal"]');
                radios.forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        saveCurrentAnswer(e.target.value);
                    });
                });

                document.getElementById('backBtn').addEventListener('click', goToPrev);
                document.getElementById('nextBtn').addEventListener('click', goToNext);

                // Tab switching
                document.getElementById('tabListening').addEventListener('click', () => {
                    if (activeTab !== 'listening' && listeningQuestions.length > 0) {
                        activeTab = 'listening';
                        perSoalTimeLeft = 60;
                        renderSoal();
                    }
                });
                document.getElementById('tabReading').addEventListener('click', () => {
                    if (activeTab !== 'reading' && readingQuestions.length > 0) {
                        activeTab = 'reading';
                        perSoalTimeLeft = 60;
                        renderSoal();
                    }
                });

                if (showPreviewButton) {
                    document.getElementById('previewBtn').addEventListener('click', () => {
                        clearAllIntervals();
                        tampilkanPreview();
                    });
                }
            }

            function tampilkanPreview() {
                testFinished = true;
                clearAllIntervals();

                // Gabungkan semua soal dengan jawaban
                const allQuestions = [
                    ...listeningQuestions.map((q, idx) => ({ ...q, userAnswer: listeningAnswers[idx], part: 'Listening' })),
                    ...readingQuestions.map((q, idx) => ({ ...q, userAnswer: readingAnswers[idx], part: 'Reading' }))
                ];

                let previewHtml = '';
                allQuestions.forEach((q, idx) => {
                    const isCorrect = q.userAnswer === q.answer;
                    const statusClass = isCorrect ? 'correct' : 'wrong';
                    const jawabanUser = q.userAnswer ? q.userAnswer : '(tidak dijawab)';
                    previewHtml += `
                        <div class="preview-item ${statusClass}">
                            <div class="preview-question">${q.part} ${q.no}: ${q.question.substring(0, 80)}...</div>
                            <div class="preview-answer">Jawaban Anda: ${jawabanUser} | Kunci: ${q.answer}</div>
                        </div>
                    `;
                });

                const totalBenar = allQuestions.filter(q => q.userAnswer === q.answer).length;
                const persen = (totalBenar / allQuestions.length * 100).toFixed(1);
                const lulus = persen >= 90 ? '‚úÖ LULUS' : '‚ùå TIDAK LULUS';

                container.innerHTML = `
                    <div class="header">
                        <div class="doraemon-icon"></div>
                        <h1>HSK 2 ‚Ä¢ Doraemon</h1>
                        <div style="width:50px;"></div>
                    </div>
                    <div class="laporan">
                        <h2>üéâ PREVIEW & HASIL</h2>
                        <div style="font-size:2rem; margin:10px;">üë§ ${userName}</div>
                        <div class="skor">${persen}%</div>
                        <div style="font-size:2rem; margin:10px;">${lulus}</div>
                        <div class="detail">
                            <div>üëÇ Listening<br>${listeningAnswers.filter((ans, i) => ans === listeningQuestions[i].answer).length}/${listeningQuestions.length}</div>
                            <div>üìñ Reading<br>${readingAnswers.filter((ans, i) => ans === readingQuestions[i].answer).length}/${readingQuestions.length}</div>
                        </div>
                        <div class="preview-grid">
                            ${previewHtml}
                        </div>
                        <button class="btn-ulang" id="ulangBtn" style="margin-top:20px;">üîÑ Coba Lagi</button>
                    </div>
                `;
                document.getElementById('ulangBtn').addEventListener('click', () => {
                    location.reload();
                });
            }

            renderModal();
        })();
    </script>
</body>
</html>